variables:
  DOCKER_TLS_CERTDIR: ""

default:
  before_script:
    - echo ${CI_REGISTRY_PASSWORD} | docker login -u ${CI_REGISTRY_USER} --password-stdin ${CI_REGISTRY}
    - export DOCKER_HOST="dind:2375"
    - ./deployment/wait-for-it.sh ${DOCKER_HOST} -t 60

test:
  image: php:8.0-cli
  script:
    - curl -sSf "https://getcomposer.org/installer" | php -- --filename=composer --install-dir=/usr/local/bin
    - composer install
    - vendor/bin/phpstan --memory-limit=-1 --no-progress
    # todo: - vendor/bin/phpunit
    - vendor/bin/ecs --no-error-table --no-progress-bar
